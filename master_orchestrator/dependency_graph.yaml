# Dependency Graph for Trading Data Pipeline
# Defines execution order and timing for all data collection tasks

daily_schedule:
  # Tier 0: Asset Universe (must run first)
  - name: "Asset Collection"
    script: "data_collectors/01_collect_assets.py"
    time: "09:30:00"
    tier: 0
    dependencies: []
    max_runtime_seconds: 120
    critical: true

  # Tier 1: Fundamental Data & Economic Indicators (no dependencies)
  - name: "Fundamental Data"
    script: "data_collectors/03_collect_fundamentals.py"
    time: "09:30:30"
    tier: 1
    dependencies: ["Asset Collection"]
    max_runtime_seconds: 300
    critical: true

  - name: "Economic Indicators"
    script: "data_collectors/04_collect_economic_indicators.py"
    time: "09:30:30"
    tier: 1
    dependencies: ["Asset Collection"]
    max_runtime_seconds: 120
    critical: true

  # Tier 2: Insider Trading & Analyst Ratings (no dependencies)
  - name: "Insider Trading"
    script: "data_collectors/07_collect_insider_trades.py"
    time: "09:35:00"
    tier: 2
    dependencies: ["Asset Collection"]
    max_runtime_seconds: 180
    critical: false

  - name: "Analyst Ratings"
    script: "data_collectors/08_collect_analyst_ratings.py"
    time: "09:35:00"
    tier: 2
    dependencies: ["Asset Collection"]
    max_runtime_seconds: 180
    critical: false

  # Tier 3: News & Sentiment (no dependencies on each other)
  - name: "News Events"
    script: "data_collectors/10_collect_news_events.py"
    time: "09:40:00"
    tier: 3
    dependencies: ["Asset Collection"]
    max_runtime_seconds: 240
    critical: true

  - name: "Sentiment Analysis"
    script: "data_collectors/05_collect_sentiment.py"
    time: "09:40:00"
    tier: 3
    dependencies: ["Asset Collection"]
    max_runtime_seconds: 900
    critical: false

  - name: "Earnings Data"
    script: "data_collectors/06_collect_earnings.py"
    time: "09:40:00"
    tier: 3
    dependencies: ["Asset Collection"]
    max_runtime_seconds: 180
    critical: true

  - name: "Options Data"
    script: "data_collectors/09_collect_options_data.py"
    time: "09:40:00"
    tier: 3
    dependencies: ["Asset Collection"]
    max_runtime_seconds: 240
    critical: false

  # Tier 4: ML Features Aggregator (needs tier 1-3)
  - name: "ML Features Aggregation"
    script: "data_preprocessing/05_ml_features_aggregator.py"
    time: "09:50:00"
    tier: 4
    dependencies: ["Fundamental Data", "Economic Indicators", "News Events", "Sentiment Analysis"]
    max_runtime_seconds: 300
    critical: true

  # Tier 5: Signal Generation (needs tier 4)
  - name: "Generate Trading Signals"
    script: "strategies/run_strategies.py"
    time: "09:55:00"
    tier: 5
    dependencies: ["ML Features Aggregation"]
    max_runtime_seconds: 180
    critical: true

  # Tier 6: Strategy Validation & Daily Report (needs tier 5)
  - name: "Validate Strategies & Generate Report"
    script: "backtesting/report_generator.py"
    time: "10:00:00"
    tier: 6
    dependencies: ["Generate Trading Signals"]
    max_runtime_seconds: 300
    critical: false

intraday_schedule:
  # Continuous tasks (9:30 AM - 4:00 PM ET)
  - name: "Price Data"
    script: "data_collectors/02_collect_price_data.py"
    interval_minutes: 1
    tier: 0
    dependencies: []
    max_runtime_seconds: 45
    critical: true
    market_hours_only: true

  - name: "Volume Data"
    script: "data_collectors/02_collect_price_data.py"
    interval_minutes: 1
    tier: 0
    dependencies: []
    max_runtime_seconds: 45
    critical: true
    market_hours_only: true

  # Dependent tasks (need price/volume data)
  - name: "Technical Indicators"
    script: "data_preprocessing/05_ml_features_aggregator.py"
    interval_minutes: 5
    tier: 1
    dependencies: ["Price Data"]
    max_runtime_seconds: 120
    critical: true
    market_hours_only: true
    args: ["--incremental"]

  - name: "ML Features Update"
    script: "data_preprocessing/05_ml_features_aggregator.py"
    interval_minutes: 5
    tier: 1
    dependencies: ["Price Data", "Technical Indicators"]
    max_runtime_seconds: 120
    critical: true
    market_hours_only: true
    args: ["--incremental"]

  # Signal Quality Monitoring (hourly during market hours)
  - name: "Signal Quality Monitoring"
    script: "backtesting/monitor_signal_quality.py"
    interval_minutes: 60
    tier: 2
    dependencies: ["ML Features Update"]
    max_runtime_seconds: 180
    critical: false
    market_hours_only: true

# Market hours configuration (Eastern Time)
market_hours:
  regular:
    start: "09:30"
    end: "16:00"
    timezone: "America/New_York"
  pre_market:
    start: "04:00"
    end: "09:30"
    timezone: "America/New_York"
  post_market:
    start: "16:00"
    end: "20:00"
    timezone: "America/New_York"

# Data freshness thresholds
freshness_thresholds:
  # Green: Data is fresh
  green:
    price_data: 300          # 5 minutes
    ml_features: 600         # 10 minutes
    fundamentals: 86400      # 24 hours
    sentiment: 3600          # 1 hour
    news: 1800               # 30 minutes
    economic: 86400          # 24 hours
    options: 3600            # 1 hour
    earnings: 86400          # 24 hours
    insider: 86400           # 24 hours
    analyst: 86400           # 24 hours

  # Yellow: Data is stale but acceptable
  yellow:
    price_data: 900          # 15 minutes
    ml_features: 1800        # 30 minutes
    fundamentals: 172800     # 48 hours
    sentiment: 7200          # 2 hours
    news: 3600               # 1 hour
    economic: 172800         # 48 hours
    options: 7200            # 2 hours
    earnings: 172800         # 48 hours
    insider: 172800          # 48 hours
    analyst: 172800          # 48 hours

  # Red: Data is critically stale (beyond yellow threshold)

# Retry configuration
retry_policy:
  max_attempts: 3
  backoff_seconds: [10, 30, 60]  # Exponential backoff
  retry_on_failure: true

# Notification configuration
notifications:
  critical_failure_email: true
  daily_summary_email: true
  slack_webhook: null  # Optional: Add webhook URL for Slack notifications
